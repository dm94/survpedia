---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import { useTranslations } from '../../../i18n/utils';

export async function getStaticPaths() {
  const inventions = await getCollection('inventions');
  return inventions.map(entry => {
    const [lang, slug] = entry.slug.split('/');
    return {
      params: { lang, slug },
      props: { entry },
    };
  });
}

const { entry } = Astro.props;
const { Content } = await entry.render();
const { lang } = Astro.params;
const t = useTranslations(lang as any);

const materialLinks = entry.data.materialsUsed?.map(id => ({
    id,
    href: `/${lang}/materials/${id}`,
    name: id
}));
---

<Layout title={entry.data.title}>
    <div class="max-w-4xl mx-auto">
        <a href={`/${lang}/inventions`} class="text-blue-600 hover:underline mb-4 inline-block">&larr; {t('inventions.title')}</a>

        <article class="bg-white dark:bg-slate-800 shadow-lg rounded-2xl overflow-hidden">
             <header class="p-8 border-b border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50">
                <div class="flex items-center gap-4 mb-2">
                     <span class="bg-indigo-600 text-white text-xs font-bold px-2 py-1 rounded">
                        {entry.data.year}
                    </span>
                    {entry.data.inventor && <span class="text-slate-500 font-medium text-sm">{entry.data.inventor}</span>}
                </div>
                <h1 class="text-4xl font-extrabold text-slate-900 dark:text-white mb-6">{entry.data.title}</h1>

                {materialLinks && materialLinks.length > 0 && (
                    <div class="mb-2">
                        <h3 class="text-sm font-bold text-slate-500 uppercase mb-2">{t('common.madeOf')}</h3>
                        <div class="flex flex-wrap gap-2">
                            {materialLinks.map(link => (
                                <a href={link.href} class="bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/30 dark:hover:bg-blue-900/50 text-blue-700 dark:text-blue-300 px-3 py-1 rounded-full text-sm font-medium transition-colors capitalize">
                                    {link.name}
                                </a>
                            ))}
                        </div>
                    </div>
                )}
             </header>

             <div class="p-8">
                <div class="prose dark:prose-invert max-w-none">
                    <Content />
                </div>
             </div>
        </article>
    </div>
</Layout>
